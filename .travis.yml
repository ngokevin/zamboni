language: python
sudo: false
python:
  - "2.7"
services:
  - redis-server
before_install:
  - scripts/travis_es.sh
  - /tmp/elasticsearch/elasticsearch-1.6.2/bin/elasticsearch -d -D es.path.data=/tmp -D es.gateway.type=none -D es.index.store.type=memory -D es.discovery.zen.ping.multicast.enabled=false
install:
  - pip install -U pip wheel
  - pip install --no-deps -r requirements/test.txt --find-links https://pyrepo.addons.mozilla.org/wheelhouse/
  - npm install
env:
  matrix:
  - RUN_TEST=assets
  - RUN_TEST=lint
  - RUN_TEST=unit
script:
  - if [ $RUN_TEST = 'assets' ]; then - ./manage.py compress_assets; fi
  - if [ $RUN_TEST = 'lint' ]; then flake8 . --exclude='node_modules,commonplace_projects,docs,.git,migrations'; fi
  - if [ $RUN_TEST = 'unit' ]; then mysql -e 'create database zamboni;'; REUSE_DB=1 ./manage.py test lib mkt --noinput --logging-clear-handlers --with-blockage --with-nicedots; fi
notifications:
  irc:
    channels:
      - "irc.mozilla.org#amo-bots"
    on_success: change
    on_failure: always
cache:
    directories:
        - node_modules
        - /tmp/elasticsearch
        - $HOME/.cache/pip
